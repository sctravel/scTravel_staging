<html lang="cn">
<head>
    <%include layout/bootstrap.ejs%>
    <%include layout/jqGridInclude.ejs%>
</head>

<body data-spy="scroll" data-target=".bs-docs-sidebar" data-twttr-rendered="true">

<%include layout/navibar.ejs%>


<div id = "orderSearch" class="container">

    <div class="row-fluid order" >
        <div  class="span2"><bold>请选择操作：</bold>
            <select id="customerToolOrderSearchSelect" class="start" style="width:140px;">
                <option value = 0>根据确认码查询</option>
                <option value = 1>根据用户姓名信息</option>
                <option value = 2>根据用户手机信息</option>
                <option value = 3>根据订单号信息</option>
            </select>
        </div>
    </div>

    <section id="orderSearchByCustomerName">
        <div class="page-header">
            <b>请输入您的姓名: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>姓名：</bold><input id="name"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByCustomerName">查询</button></div>
        </div>
    </section>

    <section id="orderSearchByCustomerPhone">
        <div class="page-header">
            <b>请输入您的手机号码: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>联系电话：</bold><input id="phone"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByCustomerPhone">查询</button></div>
        </div>
    </section>

    <section id="orderSearchByConfirmCode">
        <div class="page-header">
            <b>请输入您的确认码: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>确认码：</bold><input id="confirmCode"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByConfirmCode">查询</button></div>
        </div>

    </section>



    <section id="orderSearchByOrderId">
        <div class="page-header">
            <b>请输入订单号: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>订单号：</bold><input id="OrderId"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByOrderId">查询</button></div>
        </div>

    </section>
</div>


<section id="searchResultsPage">
    <div class="page-header">
        <h1>订单查询结果：</h1>
    </div>
    <div class="row-fluid order" >
        <table id="orderSearchResult"></table>
    </div>
    <br />
</section>


<script>

    var displayOrder = function(data){
        searchResults=data;
        console.dir(searchResults);
        jQuery("#orderSearchResult").GridUnload();
        jQuery("#orderSearchResult").jqGrid({
            data: searchResults,
            datatype: "local",
            colNames:['id','时间','客户ID','总金额','确认码','状态','说明','创建者','创建时间','最近更新时间'],
            colModel:[  {name:'order_id',index:'order_id',align:'right'},
                {name:'order_datetime',index:'order_datetime', align:"right"},
                {name:'customer_id',index:'customer_id', align:"right"},
                {name:'total_order_amount',index:'total_order_amount', align:"right"},
                {name:'confirmation_code',index:'confirmation_code', align:"right"},
                {name:'order_status',index:'order_status', align:"right"},
                {name:'description',index:'description', align:"right"},
                {name:'created_by',index:'created_by', align:"right"},
                {name:'creation_datetime',index:'created_by', align:"right"},
                {name:'last_updated_time',index:'created_by', align:"right"}
            ],
            caption: "您的订单：",
            //rowNum:10,
            //pager:$('#pager2'),
            loadonce:false,
            width:1200,
            height: "100%"
        });
    };

    $('#customerToolOrderSearchSelect').change(function(){
        var selectedOption = $( this ).val();
        $('#searchResultsPage').hide();

        if(selectedOption == 0 ) { //based on ConfirmCode
            $('#orderSearchByConfirmCode').show();
            $('#orderSearchByCustomerPhone').hide();
            $('#orderSearchByCustomerName').hide();
            $('#orderSearchByOrderId').hide();



        } else if(selectedOption == 1 ) { //based on Customer Name
            $('#orderSearchByCustomerName').show();
            $('#orderSearchByCustomerPhone').hide();
            $('#orderSearchByConfirmCode').hide();
            $('#orderSearchByOrderId').hide();

        } else if (selectedOption == 2){ //based on Customer Phone
            $('#orderSearchByCustomerPhone').show();
            $('#orderSearchByCustomerName').hide();
            $('#orderSearchByConfirmCode').hide();
            $('#orderSearchByOrderId').hide();
        }

        else if (selectedOption == 3){ //based on Customer Phone
            $('#orderSearchByOrderId').show();
        $('#orderSearchByCustomerPhone').hide();
            $('#orderSearchByCustomerName').hide();
            $('#orderSearchByConfirmCode').hide();

        }
    });

    $('#searchOrderByCustomerName').click(function(){

        console.log("Search orders by customer name");
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/admin/GetOrdersBasedOnName/'+$('#name').val(),  displayOrder);

    });


    $('#searchOrderByCustomerPhone').click(function(){

        console.log("Search orders by customer mobile phone");
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/admin/GetOrderBasedOnPhoneNumber/'+$('#phone').val(),  displayOrder);

    });

    $('#searchOrderByConfirmCode').click(function(){

        console.log("Search orders by confirmCOde");
        var confirmCode = $('#confirmCode').val();
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/admin/GetCustomersBasedOnConfirmation/'+confirmCode, displayOrder);
    });


    $('#searchOrderByOrderId').click(function(){

        console.log("Search orders by OrderId");
        var OrderId = $('#OrderId').val();
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/admin/GetOrderBasedOnOrderId/'+OrderId, displayOrder);
    });

    $(function(){
        $('#orderSearchByConfirmCode').show();
        $('#orderSearchByCustomerPhone').hide();
        $('#orderSearchByCustomerName').hide();
        $('#orderSearchByOrderId').hide();
        $('#searchResultsPage').hide();


    });











</script>





