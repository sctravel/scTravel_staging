<html lang="cn">
<head>
    <%include layout/bootstrap.ejs%>
    <%include layout/jqGridInclude.ejs%>
</head>
<table id="list2"></table>
<div id="pager2"></div>

<script src="/assets/js/jquery-1.9.1.min.js"></script>
<script src="/assets/js/bootstrap.min.js"></script>
<script src="/assets/js/holder.js"></script>
<script src="/assets/js/jquery-ui-1.10.3.custom.min.js"></script>
<script src="/assets/js/docs.js"></script>
<script src="/sctravel/grid.locale-en.js" type="text/javascript"></script>
<script src="/sctravel/jquery.jqGrid.min.js" type="text/javascript"></script>


<div id = "orderSearch" class="container">

    <div class="row-fluid order" >
        <div  class="span2"><bold>请选择操作：</bold>
            <select id="customerToolOrderSearchSelect" class="start" style="width:140px;">
                <option value = 0>根据确认码查询</option>
                <option value = 1>根据用户信息查询</option>
            </select>
        </div>
    </div>

    <section id="orderSearchByCustomerInfo">
        <div class="page-header">
            <b>请输入您的姓名和手机号码: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>姓名：</bold><input id="name"  type="text" class="amount input-small" /></div>
                <div  class="span2"><bold>联系电话：</bold><input id="phone"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByCustomerInfo">查询</button></div>
        </div>

    </section>
    <section id="orderSearchByConfirmCode">
        <div class="page-header">
            <b>请输入您的确认码: </b>
        </div>
        <form  class="well form-inline">
            <div class="row-fluid userInfo" >
                <div  class="span2"><bold>确认码：</bold><input id="confirmCode"  type="text" class="amount input-small" /></div>
            </div>
        </form>
        <div class="row-fluid" >
            <div ><button id="searchOrderByConfirmCode">查询</button></div>
        </div>

    </section>
</div>


<section id="searchResultsPage">
    <div class="page-header">
        <h1>订单查询结果：</h1>
    </div>
    <div class="row-fluid order" >
        <table id="orderSearchResult"></table>
    </div>
    <br />
</section>


<script>

    var displayOrder = function(data){
        searchResults=data;
        console.dir(searchResults);
        //jQuery("#orderSearchResult").GridUnload();
        jQuery("#orderSearchResult").jqGrid({
            data: searchResults,
            datatype: "local",
            colNames:['id','时间','客户ID','总金额','确认码','状态','说明','创建者','创建时间','最近更新时间'],
            colModel:[  {name:'order_id',index:'order_id',align:'right'},
                {name:'order_datetime',index:'order_datetime', align:"right"},
                {name:'customer_id',index:'customer_id', align:"right"},
                {name:'total_order_amount',index:'total_order_amount', align:"right"},
                {name:'confirmation_code',index:'confirmation_code', align:"right"},
                {name:'order_status',index:'order_status', align:"right"},
                {name:'description',index:'description', align:"right"},
                {name:'created_by',index:'created_by', align:"right"},
                {name:'creation_datetime',index:'created_by', align:"right"},
                {name:'last_updated_time',index:'created_by', align:"right"}
            ],
            caption: "您的订单：",
            //rowNum:10,
            //pager:$('#pager2'),
            loadonce:false,
            width:1200,
            height: "100%"
        });
    };

    $('#customerToolOrderSearchSelect').change(function(){
        var selectedOption = $( this ).val();
        $('#searchResultsPage').hide();

        if(selectedOption == 0 ) { //query account
            $('#orderSearchByConfirmCode').show();
            $('#orderSearchByCustomerInfo').hide();

        } else if(selectedOption == 1 ) { //adding new account
            $('#orderSearchByConfirmCode').hide();
            $('#orderSearchByCustomerInfo').show();

        }
    });

    $('#searchOrderByCustomerInfo').click(function(){


        console.log("Search orders by customer name and mobile phone");
        var customerInfo={};
        customerInfo.customerName = $('#name').val();
        customerInfo.mobilePhone = $('#phone').val();
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/search/orders', {"customerInfo" : customerInfo},  displayOrder);


    });

    $('#searchOrderByConfirmCode').click(function(){

        console.log("Search orders by confirmCOde");
        var confirmCode = $('#confirmCode').val();
        jQuery("#orderSearchResult").empty();
        $('#searchResultsPage').show();
        $.get('/services/search/orders', {"confirmCode" : confirmCode}, displayOrder);


    });

    $(function(){
        $('#orderSearchByConfirmCode').show();
        $('#orderSearchByCustomerInfo').hide();
        $('#searchResultsPage').hide();


    });











</script>





