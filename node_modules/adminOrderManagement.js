/**
 * Created by XiTU on 5/21/14.
 */
var constants = require('./constants');
var tableNames = require('./tableNames');
var queryDB = require('./queryDB');
var verifyUser = require('./adminLogin').verifyUser;

//TODO check the tool permission Id for this adminuser to see whether he has permission or not
exports.adminPlaceOrder = function(userInfo, orderInfo, adminUsername, randomKey, callback) {
    verifyUser(adminUsername,randomKey, function(err, results) {
        if(err) {
            console.error(err);
            callback(err,null);
            return;
        }

        if(results && results == "done") {
            console.dir(userInfo);
            console.dir(orderInfo);
            queryDB.placeOrder(userInfo,orderInfo,adminUsername,function(err,results){
                if(err) {
                    console.error(err);
                    callback(err,null);
                    return;
                }

                callback(null,results);
            })
        } else {
            calback(new Error("unknown error in adminPlaceOrder"),null);
        }
    });
}

exports.adminCancelOrder = function(orderId, adminUsername, randomKey, callback) {
    verifyUser(adminUsername,randomKey, function(err, results) {
        if(err) {
            console.error(err);
            callback(err,null);
            return;
        }

        if(results && results == "done") {
            queryDB.changeOrderStatus(orderId,constants.ORDER_STATUS.CANCELLED,0,adminUsername,function(err,results){
                if(err) {
                    callback(err,null);
                    return;
                }
                console.info("Amdin user: "+adminUsername+ " successfully cancelled order:"+orderId);
                callback(null,results);
            })
        } else {
            calback(new Error("unknown error in adminPlaceOrder"),null);
        }
    });
}