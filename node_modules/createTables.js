var mysql=require('mysql');

var connection = mysql.createConnection({
    host: 'localhost',
    user: 'root',
    password: 'travel'

});
connection.connect();
var errorHandler = function(err) {
    console.log(err);
}

connection.query('CREATE database sctravel',errorHandler);
connection.query('USE sctravel');

connection.query('DROP TABLE t_tickets_sold',errorHandler);
connection.query('DROP TABLE t_tickets_inventory',errorHandler);
connection.query('DROP TABLE t_orders',errorHandler);
connection.query('DROP TABLE t_scenery_spots',errorHandler);


connection.query('CREATE TABLE t_scenery_spots (' +
    ' spot_id INT PRIMARY KEY AUTO_INCREMENT , ' +
    ' spot_name VARCHAR(127) NOT NULL, ' +
    ' spot_type VARCHAR(31), ' +
    ' content VARCHAR(127), ' +
    ' image VARCHAR(127), ' +
    ' longitude DECIMAL(20,6), ' +
    ' latitude DECIMAL(20,6), ' +
    ' city VARCHAR(63), ' +
    ' address VARCHAR(255), ' +
    ' phone VARCHAR(14),' +
    ' hours VARCHAR(31) )ENGINE=InnoDB DEFAULT CHARSET=utf8 ', errorHandler);

connection.query('CREATE TABLE t_orders ( ' +
    ' order_id INT PRIMARY KEY AUTO_INCREMENT, ' +
    ' order_status ENUM(\'1\',\'2\',\'3\') DEFAULT \'1\', '+  //1 is paid, 2 is unpaid, 3 is expired or used
    ' email VARCHAR(63), ' +
    ' phone VARCHAR(15), ' +
    ' order_datetime TIMESTAMP DEFAULT now(), ' +
    ' name VARCHAR(32), ' +
    ' order_total_amount DECIMAL(20,6), ' +
    ' confirmation_code VARCHAR(15) ' +
    '  )ENGINE=InnoDB DEFAULT CHARSET=utf8  ' ,errorHandler );

connection.query('CREATE UNIQUE INDEX t_orders_IDX_0 on t_orders(confirmation_code)',errorHandler);

connection.query('CREATE TABLE t_tickets_sold (' +
    ' confirmation_code VARCHAR(15) NOT NULL, ' +
    ' spot_id INT NOT NULL, ' +
    ' valid_date DATE NOT NULL, ' +
    ' departure VARCHAR(63), ' +
    ' time_slot VARCHAR(5), ' + //08:00 - 18:00, half an hour interval
    ' is_valid VARCHAR(1) DEFAULT \'Y\', ' +
    ' redeem_datetime DATE, ' +
    ' quantity INT,' +
    ' total_amount DECIMAL(20,6), ' + //price*quantity
    ' creation_time TIMESTAMP DEFAULT now(), ' +
    ' FOREIGN KEY tickets_f_key_spot (spot_id) REFERENCES t_scenery_spots(spot_id) ON DELETE CASCADE, ' +
    ' FOREIGN KEY tickets_f_key_order (confirmation_code) REFERENCES t_orders(confirmation_code) ON DELETE CASCADE )ENGINE=InnoDB DEFAULT CHARSET=utf8  ', errorHandler);

connection.query('CREATE TABLE t_tickets_inventory ( ' +
    ' spot_id INT NOT NULL , ' +
    ' date DATE NOT NULL, ' +
    ' time_slot VARCHAR(5), ' +
    ' quantity INT , ' +
    ' price DECIMAL(20,6), ' +
    ' FOREIGN KEY inventory_f_key (spot_id) REFERENCES t_scenery_spots(spot_id) ON DELETE CASCADE )ENGINE=InnoDB DEFAULT CHARSET=utf8 ',errorHandler);


connection.end();