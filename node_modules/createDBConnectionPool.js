/**
 * Created by XiTU on 3/31/14.
 */



var mysql=require('mysql');

var dbOptions={
    host: 'localhost',//process.env.MYSQL_HOST,
    user: 'root',//process.env.MYSQL_USER,

    password: '',//process.env.MYSQL_PASS,
    database: 'sctravel',//process.env.MYSQL_DB,
    connectionLimit: 10,
    supportBigNumbers: true
};


var pool = mysql.createPool(dbOptions);
var errorHandler = function(err) {
      console.log(err);
}

exports.connection = mysql.createConnection(dbOptions);


exports.runQueryWithParams = function(sql, params, callback) {
    pool.getConnection(function(err,conn){
            conn.query(sql,params, function(err,results){
                    if(err){
                        console.error("Error in runQueryWithParams with SQL: "+sql+" and params: "+params);
                        callback(err,null);
                    }
                    callback(null,results);
                    conn.release();
                })
        })
}

exports.runQuery = function(sql, callback) {
     pool.getConnection(function(err,conn){
            conn.query(sql, function(err,results){
                   if(err){
                       console.error(sql+" failed \n" +err);//throw err;}
                        callback(err,null)
                   }
                   callback(null,results);
                   conn.release();
            })
     })
 }